---
/**
 * Header — sticky top navigation with pixel design.
 * Pixel font logo, terminal-style nav, mobile menu.
 */
import { Menu, X } from "@lucide/astro";
import profile from "../../data/profile";

/** Navigation links — update here to change both desktop and mobile nav. */
const navLinks = [
  { href: "/projects", label: "Projects" },
  { href: "/resume", label: "Resume" },
  { href: "/blog", label: "Blog" },
  { href: "/#contact", label: "Contact" },
];
---

<header
  class="sticky top-0 z-50 shrink-0 border-b-2 border-[var(--border-default)] bg-[var(--bg-primary)]/95 backdrop-blur-md transition-colors duration-300"
>
  <nav
    class="c-container py-4 flex justify-between items-center"
    aria-label="Main navigation"
  >
    <!-- Logo / Home link -->
    <a
      href="/"
      class="inline-flex items-center focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] px-2 py-1 border-2 border-transparent hover:border-[var(--accent)] hover:shadow-[2px_2px_0_0_var(--accent)] transition-all"
      aria-label={`${profile.name} – Home`}
    >
      <img src="/logo.svg" alt="" width="28" height="28" class="h-7 w-auto" />
    </a>

    <div class="flex items-center gap-2">
      <!-- Desktop navigation links -->
      <div class="hidden md:flex items-center gap-1">
        {
          navLinks.map((link) => (
            <a
              href={link.href}
              class="text-sm font-medium font-mono text-[var(--text-muted)] hover:text-[var(--accent)] hover:no-underline transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] px-3 py-1.5 border border-transparent hover:border-[var(--border-default)] hover:bg-[var(--bg-elevated)]"
            >
              {link.label}
            </a>
          ))
        }
      </div>

      <!-- Mobile menu toggle (min 44px touch target) -->
      <button
        id="mobile-menu-toggle"
        type="button"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
        class="md:hidden min-w-[44px] min-h-[44px] flex items-center justify-center p-2 text-[var(--text-muted)] hover:text-[var(--accent)] hover:bg-[var(--bg-elevated)] border border-transparent hover:border-[var(--border-default)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)]"
      >
        <Menu size={22} id="menu-icon" aria-hidden="true" />
        <X size={22} id="close-icon" class="hidden" aria-hidden="true" />
      </button>
    </div>
  </nav>

  <!-- Mobile menu (terminal-inspired) -->
  <div
    id="mobile-menu"
    class="hidden md:hidden border-t-2 border-[var(--border-default)] bg-[var(--bg-primary)]"
    role="navigation"
    aria-label="Mobile menu"
  >
    <div class="c-container py-3 flex flex-col gap-0.5">
      {
        navLinks.map((link) => (
          <a
            href={link.href}
            class="px-4 py-3 font-mono text-sm text-[var(--text-primary)] font-medium hover:bg-[var(--bg-elevated)] hover:text-[var(--accent)] hover:no-underline transition-colors focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-inset border-l-2 border-transparent hover:border-[var(--accent)]"
          >
            <span class="text-[var(--text-subtle)] mr-2" aria-hidden="true">&gt;</span>
            {link.label}
          </a>
        ))
      }
    </div>
  </div>
</header>

<!-- Mobile menu handler (re-runs on astro:after-swap for view transitions) -->
<script>
  function initMobileMenu() {
    const mobileMenuToggle = document.getElementById("mobile-menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = document.getElementById("menu-icon");
    const closeIcon = document.getElementById("close-icon");

    if (!mobileMenuToggle || !mobileMenu || !menuIcon || !closeIcon) return;
    if (mobileMenuToggle.hasAttribute("data-mobile-menu-bound")) return;
    mobileMenuToggle.setAttribute("data-mobile-menu-bound", "true");

    mobileMenuToggle.addEventListener("click", () => {
      const isOpen = !mobileMenu.classList.contains("hidden");
      mobileMenu.classList.toggle("hidden");
      menuIcon.classList.toggle("hidden");
      closeIcon.classList.toggle("hidden");
      mobileMenuToggle.setAttribute("aria-expanded", isOpen ? "false" : "true");
    });

    mobileMenu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.add("hidden");
        menuIcon.classList.remove("hidden");
        closeIcon.classList.add("hidden");
        mobileMenuToggle.setAttribute("aria-expanded", "false");
      });
    });
  }

  initMobileMenu();
  document.addEventListener("astro:after-swap", initMobileMenu);
</script>
