---
import { Github, ExternalLink } from '@lucide/astro';

interface Props {
  title: string;
  description: string;
  tech?: string[];
  github?: string;
  liveLink?: string;
  image?: string;
  featured?: boolean;
  href?: string;
}

const { title, description, tech = [], github, liveLink, image, featured = false, href } = Astro.props;

const cardClass = href
  ? `group flex flex-col rounded-xl border border-[var(--border-default)] bg-[var(--bg-primary)] overflow-hidden transition-all duration-200 hover:border-[var(--accent)] hover:shadow-[0_4px_12px_rgba(0,0,0,0.08)] dark:hover:shadow-[0_4px_12px_rgba(0,0,0,0.25)] ${featured ? 'border-l-4 border-l-[var(--accent)]' : ''}`
  : `group flex flex-col rounded-xl border border-[var(--border-default)] bg-[var(--bg-primary)] overflow-hidden transition-all duration-200 ${featured ? 'border-l-4 border-l-[var(--accent)]' : ''}`;
---

<article class={cardClass}>
  {href ? (
    <>
      <a href={href} class="block no-underline text-inherit">
        {image && (
          <div class="relative overflow-hidden aspect-video bg-[var(--bg-elevated)]">
            <img
              src={image}
              alt=""
              class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.02]"
              loading="lazy"
            />
          </div>
        )}
        <div class="flex flex-col flex-1 p-5 md:p-6 gap-3">
          <div class="flex items-start justify-between gap-4">
            <h3 class="font-heading font-semibold text-lg text-[var(--text-primary)] leading-tight">
              {title}
            </h3>
            {featured && (
              <span class="shrink-0 text-xs font-medium px-2.5 py-1 rounded-lg bg-[var(--accent-muted)] text-[var(--accent)] whitespace-nowrap">
                Featured
              </span>
            )}
          </div>
          <p class="text-sm text-[var(--text-muted)] leading-relaxed flex-1">
            {description}
          </p>
          {tech.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {tech.map((t: string) => (
                <span class="text-xs px-2.5 py-1 rounded-lg bg-[var(--bg-elevated)] text-[var(--accent)] border border-[var(--border-default)] font-medium">
                  {t}
                </span>
              ))}
            </div>
          )}
        </div>
      </a>
      <div class="flex gap-3 px-5 md:px-6 pb-5 md:pb-6 pt-2 border-t border-[var(--border-subtle)]">
        {github && (
          <a
            href={github}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 text-sm font-medium text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] rounded px-2 py-1"
            aria-label={`View ${title} on GitHub`}
          >
            <Github size={16} aria-hidden="true" />
            Code
          </a>
        )}
        {liveLink && (
          <a
            href={liveLink}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 text-sm font-medium text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] rounded px-2 py-1"
            aria-label={`View ${title} live`}
          >
            <ExternalLink size={16} aria-hidden="true" />
            Demo
          </a>
        )}
      </div>
    </>
  ) : (
    <>
      {image && (
        <div class="relative overflow-hidden aspect-video bg-[var(--bg-elevated)]">
          <img src={image} alt="" class="w-full h-full object-cover" loading="lazy" />
        </div>
      )}
      <div class="flex flex-col flex-1 p-5 md:p-6 gap-3">
        <div class="flex items-start justify-between gap-4">
          <h3 class="font-heading font-semibold text-lg text-[var(--text-primary)] leading-tight">
            {title}
          </h3>
          {featured && (
            <span class="shrink-0 text-xs font-medium px-2.5 py-1 rounded-lg bg-[var(--accent-muted)] text-[var(--accent)] whitespace-nowrap">
              Featured
            </span>
          )}
        </div>
        <p class="text-sm text-[var(--text-muted)] leading-relaxed">
          {description}
        </p>
        {tech.length > 0 && (
          <div class="flex flex-wrap gap-2">
            {tech.map((t: string) => (
              <span class="text-xs px-2.5 py-1 rounded-lg bg-[var(--bg-elevated)] text-[var(--accent)] border border-[var(--border-default)]">
                {t}
              </span>
            ))}
          </div>
        )}
      </div>
      <div class="flex gap-3 px-5 md:px-6 pb-5 md:pb-6 pt-2 border-t border-[var(--border-subtle)]">
        {github && (
          <a
            href={github}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 text-sm font-medium text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] rounded px-2 py-1"
            aria-label={`View ${title} on GitHub`}
          >
            <Github size={16} aria-hidden="true" />
            Code
          </a>
        )}
        {liveLink && (
          <a
            href={liveLink}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 text-sm font-medium text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] rounded px-2 py-1"
            aria-label={`View ${title} live`}
          >
            <ExternalLink size={16} aria-hidden="true" />
            Demo
          </a>
        )}
      </div>
    </>
  )}
</article>
